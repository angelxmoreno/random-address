version: '2'
services:
  fpm:
    container_name: random-address-fpm
    image: angelxmoreno/php7-fpm-alpine-dev-pgsql
    build:
      context: ./docker
      dockerfile: DockerfileFpm
    volumes:
    - '.:/var/www/html'
    - './docker/php.ini:/usr/local/etc/php/php.ini:ro'
    links:
    - mysql
    - mysql-test
    - redis
    - es
  web:
    container_name: random-address-nginx
    image: 'nginx:1.13-alpine'
    links:
    - fpm
    ports:
    - '8721:80'
    volumes:
    - './docker/site.conf:/etc/nginx/conf.d/_site.conf:ro'
    volumes_from:
    - fpm
  redis:
    container_name: random-address-redis
    image: 'redis:4.0-alpine'
    ports:
    - '8723:6379'
    command: 'redis-server --appendonly yes'
    volumes:
    - './docker/data/redis/:/data'
  es:
    container_name: random-address-es
    image: 'elasticsearch:5-alpine'
    ports:
    - '8724:9200'
    - '8725:9300'
    volumes:
    - './docker/data/es/:/usr/share/elasticsearch/data'
  mysql:
    container_name: random-address-mysql
    image: 'mariadb:10.1'
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
    environment:
    - MYSQL_ROOT_PASSWORD=random-address
    - MYSQL_USER=random-address
    - MYSQL_PASSWORD=random-address
    - MYSQL_DATABASE=random-address
    volumes:
    - './docker/data/mysql/:/var/lib/mysql'
    - './data/:/var/csvs'
    ports:
    - '8722:3306'
  mysql-test:
    container_name: random-address-mysql-test
    image: 'mariadb:10.1'
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
    environment:
    - MYSQL_ROOT_PASSWORD=random-address-test
    - MYSQL_USER=random-address-test
    - MYSQL_PASSWORD=random-address-test
    - MYSQL_DATABASE=random-address-test
    volumes:
    - './docker/data/mysql-test/:/var/lib/mysql'
    ports:
    - '8922:3306'
  statsd:
    container_name: random-address-statsd
    image: statsd:random-address
    build:
      context: ./docker
      dockerfile: DockerfileStatsD
    environment:
    - MYSQL_ROOT_PASSWORD=random-address-test
    - MYSQL_USER=random-address-test
    - MYSQL_PASSWORD=random-address-test
    - MYSQL_DATABASE=random-address-test
    volumes:
      - '.:/var/www/html'
    ports:
    - 8125
    - 8126
